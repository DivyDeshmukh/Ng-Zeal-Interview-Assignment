<div class="container py-3">
  <h2 class="mb-3">Contracts</h2>

  <div class="row g-2 align-items-center">
    <div class="col-sm-3">
      <input #q class="form-control" placeholder="Search title or party" (input)="onSearch(q.value)">
    </div>

    <div class="col-sm-3">
      <input #party class="form-control" placeholder="Party" (input)="onParty(party.value)">
    </div>

    <div class="col-sm-3">
      <select #status class="form-select" (change)="onStatus(status.value)">
        <option value="">All statuses</option>
        <option value="draft">draft</option>
        <option value="sent">sent</option>
        <option value="signed">signed</option>
        <option value="expired">expired</option>
        <option value="terminated">terminated</option>
      </select>
    </div>

    <div class="col-sm-2 d-flex">
      <input #exp type="number" min="0" class="form-control me-2"
       placeholder="Expiring days"
       (input)="onExpiring(+exp.value)" />
      <button class="btn btn-outline-secondary" (click)="resetFilters(q, party, status, exp)">Reset</button>
    </div>
  </div>

  <div class="mt-3" *ngIf="loading$ | async">
    <div class="alert alert-info py-2 mb-0">Loadingâ€¦</div>
  </div>

  <div class="table-responsive mt-2">
    <table class="table table-sm table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Title</th>
          <th>Party</th>
          <th>Status</th>
          <th>Start</th>
          <th>End</th>
          <th class="text-end">Amount</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of rows$ | async; trackBy: trackById" (click)="openDetail(c)" style="cursor:pointer">
          <td>{{ c.title }}</td>
          <td>{{ c.party }}</td>
          <td>
            <span class="badge bg-secondary" [ngClass]="{
              'bg-info': c.status==='sent',
              'bg-success': c.status==='signed',
              'bg-warning text-dark': c.status==='expired',
              'bg-danger': c.status==='terminated'
            }">{{ c.status }}</span>
          </td>
          <td>{{ c.startDate | date }}</td>
          <td>{{ c.endDate | date }}</td>
          <td class="text-end">{{ c.amount | money:(c.currency||'INR') }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="d-flex justify-content-between align-items-center">
    <div class="small text-muted">Total: {{ total$ | async }}</div>
    <div class="btn-group">
      <button class="btn btn-outline-secondary btn-sm" (click)="prevPage()">Prev</button>
      <button class="btn btn-outline-secondary btn-sm" (click)="nextPage()">Next</button>
    </div>
  </div>
</div>
